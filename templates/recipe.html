{% extends "base.html" %}

{% block title %}{{ recipe.title }} - Recipe Manager{% endblock %}

{% block content %}
<div class="recipe-detail">
    <div class="recipe-header">
        <div class="recipe-header-content">
            <span class="category-badge category-{{ recipe.category|lower }}">{{ recipe.category }}</span>
            <h1>{{ recipe.title }}</h1>
            {% if recipe.description %}
                <p class="recipe-description">{{ recipe.description }}</p>
            {% endif %}

            <div class="recipe-meta">
                {% if recipe.prep_time %}
                    <div class="meta-box">
                        <span class="meta-label">Prep</span>
                        <span class="meta-value">{{ recipe.prep_time }} min</span>
                    </div>
                {% endif %}
                {% if recipe.cook_time %}
                    <div class="meta-box">
                        <span class="meta-label">Cook</span>
                        <span class="meta-value">{{ recipe.cook_time }} min</span>
                    </div>
                {% endif %}
                {% if recipe.total_time %}
                    <div class="meta-box">
                        <span class="meta-label">Total</span>
                        <span class="meta-value">{{ recipe.total_time }} min</span>
                    </div>
                {% endif %}
                <div class="meta-box">
                    <span class="meta-label">Servings</span>
                    <span class="meta-value">{{ recipe.servings }}</span>
                </div>
            </div>

            {% if recipe.calories or recipe.protein or recipe.carbs or recipe.fat %}
            <div class="macros-display">
                <h3>Nutrition <span class="macro-note">(per serving)</span></h3>
                <div class="macros-grid">
                    {% if recipe.calories %}
                    <div class="macro-item macro-calories">
                        <span class="macro-value">{{ recipe.calories }}</span>
                        <span class="macro-label">Calories</span>
                    </div>
                    {% endif %}
                    {% if recipe.protein %}
                    <div class="macro-item macro-protein">
                        <span class="macro-value">{{ recipe.protein }}g</span>
                        <span class="macro-label">Protein</span>
                    </div>
                    {% endif %}
                    {% if recipe.carbs %}
                    <div class="macro-item macro-carbs">
                        <span class="macro-value">{{ recipe.carbs }}g</span>
                        <span class="macro-label">Carbs</span>
                    </div>
                    {% endif %}
                    {% if recipe.fat %}
                    <div class="macro-item macro-fat">
                        <span class="macro-value">{{ recipe.fat }}g</span>
                        <span class="macro-label">Fat</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <div class="recipe-actions">
            <a href="{{ url_for('edit_recipe', id=recipe.id) }}" class="btn btn-secondary">Edit</a>
            <form action="{{ url_for('delete_recipe', id=recipe.id) }}" method="POST" class="inline-form" onsubmit="return confirm('Delete this recipe?')">
                <button type="submit" class="btn btn-danger">Delete</button>
            </form>
        </div>
    </div>

    <div class="recipe-content">
        <div class="ingredients-section">
            <div class="section-header">
                <h2>Ingredients</h2>
                <form class="servings-adjuster" method="GET">
                    <label for="servings">Servings:</label>
                    <input type="number"
                           name="servings"
                           id="servings"
                           value="{{ servings }}"
                           min="1"
                           max="100"
                           class="servings-input">
                    <button type="submit" class="btn btn-small">Scale</button>
                    {% if servings != recipe.servings %}
                        <a href="{{ url_for('view_recipe', id=recipe.id) }}" class="btn btn-small btn-ghost">Reset</a>
                    {% endif %}
                </form>
            </div>

            <ul class="ingredient-list">
                {% for ing in scaled_ingredients %}
                    <li class="ingredient-item">
                        {% if ing.amount %}
                            <span class="ingredient-amount">{{ ing.amount }}</span>
                        {% endif %}
                        {% if ing.unit %}
                            <span class="ingredient-unit">{{ ing.unit }}</span>
                        {% endif %}
                        <span class="ingredient-name">{{ ing.name }}</span>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <div class="instructions-section">
            <h2>Instructions</h2>
            {% if recipe.instructions %}
                <div class="instructions-text">
                    {% for step in recipe.instructions.split('\n') %}
                        {% if step.strip() %}
                            <p class="instruction-step">{{ step }}</p>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <p class="no-instructions">No instructions added yet.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
